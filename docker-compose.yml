version: '3.4'

services:
    assets:
        build:
            context: .
            dockerfile: Dockerfile
            target: assets_builder
            args:
                environment: ${ENVIRONMENT}
                node_version: ${NODE_VERSION}
    ui:
        build:
            context: .
            dockerfile: Dockerfile
            target: ui
            args:
                node_version: ${NODE_VERSION}
        ports:
            - "8889:80"
        depends_on:
            - assets
    ci:
        build:
            context: .
            dockerfile: Dockerfile
            target: ci
            args:
                node_version: ${NODE_VERSION}
        depends_on:
            - assets
            - ui
            - selenium
    selenium:
        build:
            context: .
            dockerfile: Dockerfile
            target: selenium
            args:
                selenium_image_suffix: ${SELENIUM_IMAGE_SUFFIX}
                node_version: ${NODE_VERSION}
        ports:
            - "4444:4444" # WebDriver protocol
            - "5900:5900" # VNC
        volumes:
            # https://github.com/SeleniumHQ/docker-selenium#running-the-images
            - /dev/shm:/dev/shm

